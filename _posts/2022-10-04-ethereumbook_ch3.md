---
layout: post                           # (require) default post layout
title: "마스터링 이더리움 ch3"              # (require) a string title
date: 2022-10-04 19:00:00 +0900        # (require) a post date
categories: [all, ethereum, blockchain, 마스터링 이더리움]  # (custom) some categories, but makesure these categories already exists inside path of `category/`
---

# 마스터링 이더리움 ch3 이더리움 클라이언트
'마스터링 이더리움 스마트 컨트랙트 및 댑 구축하기' 책의 세미나
제 3장 이더리움 클라이언트


## 이더리움 클라이언트란?
* 이더리움 사양을 구현하고 다른 이더리움 클라이언트와 피어투피어 네트워크를 통해 통신
  * 기존 사양과 표준 통신 프로토콜을 준수할때 다른 이더리움 클라이언트와 상호운용이 가능 
  * 모두 동일한 프로토콜로 소통하고 동일한 규칙을 따름
* “이더리움 네트워크”가 존재하고, 이더리움 네트워크 접속을 도와주는 여러 클라이언트가 존재
* 블록체인은 p2p 방식을 채택

### p2p 네트워크의 장점
* 자유로움
  * 많은 개발자가 참여, 다양한 프로그램이 등장할 가능성 상승
* 가격절감
  * 네트워크만 생성해놓으면 여러 사람들이 각자의 서버를 자청햐여 개발
  * 중앙에서 이익과 손해를 보는 시스템과 달리 가격 절감 가능
  * 적절한 보상이 있을시 안정적인 서비스 가능
* 보안
  * p2p 접속한 모든 컴퓨터가 서버-클라이언트 역할을 하며 서로를 감시
* 탈중앙화
  * 하나의 컴퓨터가 해킹되어 잘못된 값이 나왔을때 대다수의 나머지 컴퓨터와 값을 비교하여 잘못된 값을 보낸 컴퓨터를 무시
* 가용성
  * 이더리움 네트워크 사용자의 모든 컴퓨터가 서버이고 클라이언트, 서버에 장애가 발생하더라도 이용 가능
* 신뢰성
  * p2p 기반의 실시간 노드공유를 통해서 투명성을 높임
  
### 오픈소스 프로젝트
* 이더리움은 오픈소스 이기때문에 많은 개발자들이 개발에 참여할수록 신뢰할 수 있는 코드
* 이더리움은 황서 (yellow paper) 라는 공식사양에 의해 정의
* 이더리움 개선제안과 함께 이더리움 클라이언트의 표준작동 방식을 정의
* 이더리움은 클라이언트가 구현될 사양에 대해 명확한 기준을 제시함(황서)으로써 여러 클라이언트들과 상호운용이 가능


## 이더리움 네트워크
### 이더리움 클라이언트를 이더리움 네트워크에 연결하는 방법
* 풀 노드 방식(블록체인에서 이뤄진 모든 거래 내역을 저장)
  * 장점
    * 이더리움 기반 네트워크의 복원력과 검열 저항을 지원
    * 모든 트랜잭션을 정식으로 검증
    * 중개자 없이 공개 블록체인의 모든 컨트랙트와 상호작용
    * 중개자 없이 컨트랙트를 공개 블록체인에 직접 배포
    * 블록체인 상태(계정, 스마트 컨트랙트 등)를 오프라인에서 조회(읽기 전용)
    * 내가 읽은 정보를 제3자에게 노출하지 않고 가져올 수 있음
  * 단점
    * 하드웨어와 대역폭 자원의 확대가 필요
    * 처음 시작할 때 전체 동기화를 위해 여러 날이 소요
    * 동기화를 유지하기 위해 관리하고, 업그레이드하고, 온라인 상태로 유지
* 공개 테스트넷 노드(테스트를 위한)
  * 장점
    * 테스트넷 노드는 이더리움 네트워크보다 훨씬 적은 데이터 (2018/9기준 10gb)와의 동기화를 필요로함
    * 동기화할 용량이 적어서 몇시간내에 전체 동기화가 가능함
    * 컨트랙트 배포 및 트랜잭션 생성을 위한 테스트용 이더를 몇몇 faucet으로부터 무료로 얻을 수 있음
    * 테스트넷은 다른 많은 스마트 컨트랙트가 동작(live)실행 중인 공개 블록체인
  * 단점
    * 테스트넷에서 실제 돈을 사용할 수 없음
    * 실전 테스트 불가
* 로컬 사설 블록체인 가나슈(Ganache), 클라우드기반 인프라(Infura)를 사용하여 연결
  * 장점
    * 동기화가 없고 직접 첫번째 블록을 채굴
    * 테스트 이더를 얻을 필요가 없음. 테스트를 위해 사용할 채굴보상을 자신에게 수여(award)
    * 다른 사용자 없음
    * 다른 컨트랙트는 없고 내가 시작하고 배포한 컨트랙트만 존재
  * 단점
    * 다른 사용자가 없다는 것은 공개 블록체인과 동일하게 동작하지 않는다는 뜻
    * 나말고 채굴자가 없다. 공개 블록체인에서 발생하는 시나리오 테스트 불가
    * 다른 컨트랙트가 없다는 건 테스트를 위해 의존성을 갖는 라이브러리를 포함해 모든것을 내가 배포해야함
  
* 원격 클라이언트 실행(Metamask, Emerald Wallet, MyEtherWallet, MyCrypto Wallet...)
  * 장점
    * 지갑의 기능을 제공하며 트랜잭션을 생성
    * 원격 클라이언트를 사용하여 자신의 풀 노드, 공개 블록체인, 공개 또는 허가된 테스트넷, 개인 로컬 블록체인을 기존 네트워크에 연결할 수 있음
    * 원격 클라이언트 및 지갑 이라는 용어는 혼용되어 사용되기도 하지만 서로 다른점이 있음. 일반적으로 원격 클라이언트는 지갑의 트랜잭션 기능 외에도 API(web3.js API)를 제공
  * 단점
    * 이더리움 원격 클라이언트는 블록헤더 또는 트랜잭션의 유효성을 검사 하지 않음
    * full client를 신뢰하여 블록체인에 대한 접근 권한을 부여하므로 보안 및 익명성 보장 수준이 상당히 떨어짐

## 이더리움 네트워크란?
이더리움 기반 네트워크에는 이더리움, 이더리움 클래식, 엘라, 잇그팬스, 유비크 ,뮤지코인.. 등 여러 네트워크가 존재
현재 여섯가지 언어로 작성된 이더리움 프로토콜이 존재
* Rust로 작성된 Parity
* Go로 작성된 Geth
* C++로 작성된 cpp-ethereum
* Python으로 작성된 pyethereum
* Scala로 작성된 Mantis
* Java로 작성된 Harmony

## 이더리움 블록체인 동기화
* 블록체인을 동기화할때 블록체인은 제네시스블록(첫블록)부터 시작해서 모든 블록의 트랜잭션을 다운로드하고 유효성 검사를 실시
* 완전히 동기화 하는것이 가능하지만 시간이 매우 오래걸리고 많은 자원을 필요
* 만약 도중에 공격받은 블록이 있다면 유효성 검사에 시간이 더 많이 걸리게 됨
  * 이더리움은 2016년 말 DOS 공격을 받음
    * gas fee가 낮게 책정되었을때 빈 거래를 발생시켜서 네트워크에 무리를 줌
  * 새로운 이더리움 클라이언트는 블록 2,283,397번째에 도달할때까지는 빠르게 진행
  * 이 블록부터 공격이 끝난 2,700,031번 블록까지의 유효성 검사의 시간은 매우 느리게 진행
* DAO 해킹(2016년 6월 17일 DAO 취약점을 이용해 약 360만개의 이더리움 (640억)이 도난당하는 사태) 때문에 이더리움은 하드포크 (새로운 이더리움 네트워크를 만듬)를 함
* 전체 유효성 검사로 동기화하면 클라이언트 속도가 느려지고 공격받은 블록의 유효성을 확인하는데만 엄청난 시간이 걸림
* 대부분의 이더리움 클라이언트는 트랜잭션의 전체 유효성검사를 건너띄고 블록체인 일부에 동기화될때까지 빠른 동기화를 수행하는 옵션(—fast 명령어)을 제공

### JSON RPC 인터페이스
이더리움 클라이언트는 애플레케이션 인터페이스와 JSON으로 인코딩된 RPC 명령을 제공
* RPC
  * 클라이언트에서 서버로 필요한 파라미터를 보내어 프로시저(특정 작업을 수행하기 위한)를 동작
* JSON-RPC
  * RPC를 JSON 포맷으로 만든것을 뜻함
  * JSON-RPC API는 이더리움 클라이언트를 이더리움 네트워크 및 블록체인의 게이트웨이로 사용하는 프로그램을 작성할 수있게 해주는 인터페이스 명세서
  
일반적으로 RPC 인터페이스는 포트 8545에서 HTTP서비스로 제공되며, JSON-RPC API를 접근하기 위해 각 RPC 명령에 해당하는 스텁(stub) 함수 호출을   
제공하는 라이브러리를 사용하거나 HTTP 요청과 JSON으로 인코딩 된 보내기/받기 요청을 수동으로 생성, curl 같은 커맨드 라인을 통해 HTTP 클라이언트 사용하여 RPC 호출
```shell
$ curl -X POST -H "Content-Type: application/json" --data \
  '{"jsonrpc":"2.0","method":"web3_clientVersion","params":[],"id":1}' \
  http://localhost:8545
  
{"jsonrpc":"2.0","id":1,"result":"Geth/v1.8.0-unstable-02aeb3d7/linux-amd64/go1.8.3"}
```

### 원격 이더리움 네트워크란?
원격 클라이언트는 풀노드 클라이언트의 일부 기능을 제공. 원격 클라이언트는 더 빠르고 데이터 용량도 훨씬 적게 요구
원격 클라이언트는 일반적으로 다른곳에서 실행되고있는 풀 노드에 연결하여 이더리움 블록체인의 로컬 사본으로 동기화 하지 않고 풀 노드 이더리움 클라이언트 기능중 일부만 제공
#### 원격 이더리움 클라인트로 만든 어플
* 모바일(스마트폰) 지갑
  * 잭스
  * 스태터스
  * 트러스트월렛
  * 사이퍼 브라우저
* 브라우저 지갑(크롬, 파이어폭스)
  * 메타마스크
  * 잭스
  * 마이이더월렛
  * 미스트
  * 마이크립토

 
  
  
